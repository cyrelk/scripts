# -*- mode: shell-script -*-

validate_container () {
    debug "  validate_box $1 $2"

    local user=$1
    local box=$2

    return 0
}

enable_unprivileged_containers () {
    debug "  enable_unprivileged_containers"

    echo 1 > /sys/fs/cgroup/cpuset/cgroup.clone_children
    sysctl -w kernel.unprivileged_userns_clone=1
}

# create the user's control groups if they are not existing yet
create_user_groups () {
    debug "  create_user_groups $1"

    local user=$1
    cgm create all $user
    cgm chown all $user $(id -u $user) $(id -g $user)
}

start_user_container () {
    local user=$1
    local box=$2

    su - $user \
       -c "cgm movepid all $user $$ && lxc-start -n $box -d"
}

stop_user_container () {
    local user=$1
    local box=$2

    su - $user \
       -c "cgm movepid all $user $$ && lxc-stop -n $box"
}
